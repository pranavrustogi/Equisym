package com.equisym.service.student;

import java.io.UnsupportedEncodingException;
import java.time.DayOfWeek;
import java.time.LocalDate;
import java.util.List;
import java.util.Optional;

import javax.mail.MessagingException;
import javax.mail.internet.MimeMessage;

import org.springframework.mail.MailException;
import org.springframework.mail.javamail.MimeMessageHelper;
import org.springframework.stereotype.Service;

import com.equisym.model.Slots;
import com.equisym.model.Students;
import com.equisym.model.Users;
import com.equisym.model.Repository.SlotRepository;
import com.equisym.model.Repository.StudentRepository;
import com.equisym.web.dto.StudentsDto;


@Service
public class StudentServiceImpl implements StudentService
{
	private StudentRepository studentRepository;

	
	public StudentServiceImpl(StudentRepository studentRepository)
	{
		super();
		this.studentRepository = studentRepository;
	}
	
	
	public Students save(StudentsDto studentsDto) 
	{
		Students students = new Students(studentsDto.getFirstName(),studentsDto.getLastName(),studentsDto.getEmail(),studentsDto.getContact(), studentsDto.getRoleName(), studentsDto.getCourse(),studentsDto.getDate(),studentsDto.getDate().getDayOfWeek(),studentsDto.getTimeIn(),studentsDto.getTimeOut(), studentsDto.getSsn());
		return studentRepository.save(students);
	}
	
	@Override
	public void sendEmail(String email) throws UnsupportedEncodingException, MessagingException, MailException
	{
		try 
		{
			Students student = studentRepository.findByEmail(email);
			String subject = "Reset Password";
			String senderName = "Equisym Team";
			String mailContent= "<p>Dear " + userInfo.getFirstName() +" " +userInfo.getLastName() +",</p>";
			mailContent+= "<p>Please Click the link below to reset your password:</p>";
			
			String resetURL = siteURL + "/reset?code="+ userInfo.getResetPasswordCode();
			
			mailContent+= "<h3><a href=\"" + resetURL +"\">RESET PASSWORD</a></h3>";
			
			mailContent+= "<p> Thank you<br>Equisym Team</p>";
		
			MimeMessage message = mailSender.createMimeMessage();
			MimeMessageHelper helper = new MimeMessageHelper(message);
			helper.setFrom("equisymsantaknights@gmail.com", senderName);
			helper.setTo(user.getEmail());
			helper.setSubject(subject);
			
			helper.setText(mailContent, true);
			mailSender.send(message);
		
		}
		catch (MailException | UnsupportedEncodingException | MessagingException e) 
		{
		e.printStackTrace();
		}
	}
	
	
		
		
}

